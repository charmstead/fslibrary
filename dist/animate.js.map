{"version":3,"sources":["../src/animate.ts"],"names":[],"mappings":"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","file":"animate.js","sourcesContent":["import { addClass, append, assign, css, fastdom, height, includes, index, isVisible, noop, position, Promise, removeClass, scrollTop, toFloat, toNodes, Transition } from '../js/util/index';\n\nconst targetClass = 'uk-animation-target';\n\nexport default {\n\n    // props: {\n    //     animation: Number\n    // },\n\n    // data: {\n    //     animation: 400\n    // },\n\n    // computed: {\n\n    //     target() {\n    //         return this.$el;\n    //     }\n\n    // },\n\n    methods: {\n\n        animate(action,target,animation) {\n            const {duration,easing,effects} =animation;\n            const effect = String(effects).replace(/^fade /gi,\"\");\n            addStyle();\n\n            let children = toNodes(target.children);\n            let propsFrom = children.map(el => getProps(el, true));\n\n            const oldHeight = height(target);\n            const oldScrollY = window.pageYOffset;\n\n            action();\n\n            Transition.cancel(target);\n            children.forEach(Transition.cancel);\n\n            reset(target);\n            // this.$update(target);\n            fastdom.flush();\n\n            const newHeight = height(target);\n\n            children = children.concat(toNodes(target.children).filter(el => !includes(children, el)));\n\n            const propsTo = children.map((el, i) =>\n                el.parentNode && i in propsFrom\n                    ? propsFrom[i]\n                        ? isVisible(el)\n                            ? getPositionWithMargin(el)\n                            : { opacity: 0 }\n                        : { opacity: isVisible(el) ? 1 : 0 }\n                    : false\n            );\n\n            propsFrom = propsTo.map((props, i) => {\n                const from = children[i].parentNode === target\n                    ? propsFrom[i] || getProps(children[i])\n                    : false;\n\n                if (from) {\n                    if (!props) {\n                        delete from.opacity;\n                    } else if (!('opacity' in props)) {\n                        const { opacity } = from;\n\n                        if (opacity % 1) {\n                            props.opacity = 1;\n                        } else {\n                            delete from.opacity;\n                        }\n                    }\n                }\n\n                return from;\n            });\n\n            addClass(target, targetClass);\n            children.forEach((el, i) => {\n                if(propsFrom[i]){\n                    css(el, propsFrom[i])\n                }\n            });\n\n            css(target, 'height', oldHeight);\n            scrollTop(window, oldScrollY);\n\n            return Promise.all(children.map((el, i) =>{\n\n                if (propsFrom[i] && propsTo[i]){\n                    return Transition.start(el, propsTo[i], duration, easing)\n                }\n               return Promise.resolve();\n            }).concat(Transition.start(target, { height: newHeight }, duration, easing)))\n                .then(() => {\n                    \n                    children.forEach((el, i) => {\n                        css(el, { display: propsTo[i].opacity === 0 ? 'none' : '', zIndex: '',transform:el.style.transform })\n                    });\n                    reset(target);\n                    // this.$update(target);\n                    fastdom.flush(); // needed for IE11\n                }, noop);\n\n        }\n    }\n};\n\nfunction getProps(el, opacity?) {\n\n    const zIndex = css(el, 'zIndex');\n    return isVisible(el)\n        ? assign({\n            display: '',\n            opacity: opacity ? css(el, 'opacity') : '0',\n            pointerEvents: 'none',\n            position: 'absolute',\n            zIndex: zIndex === 'auto' ? index(el) : zIndex\n        }, getPositionWithMargin(el))\n        : false;\n}\n\nexport function reset(el) {\n    \n    css(el.children, {\n        height: '',\n        left: '',\n        opacity: '',\n        pointerEvents: '',\n        position: '',\n        top: '',\n        width: ''\n    });\n    removeClass(el, targetClass);\n    css(el, 'height', '');\n}\n\nfunction getPositionWithMargin(el) {\n    const { height, width } = el.getBoundingClientRect();\n    let { top, left } = position(el);\n    top += toFloat(css(el, 'marginTop'));\n    return { top, left, height, width};\n}\n\nlet style;\n\nfunction addStyle() {\n    if (style) {\n        return;\n    }\n    style = append(document.head, '<style>').sheet;\n    style.insertRule(\n        `.${targetClass} > * {\n            margin-top: 0 !important;\n            /*transform: none !important;/*\n        }`, 0\n    );\n}\n"]}